(function(){if(!window.location.hostname.includes("cybersafe-india.vercel.app"))return;console.log("CyberSafe India website sync script loaded");function c(){try{if(window.firebase&&window.firebase.auth){const e=window.firebase.auth().currentUser;if(e)return{isAuthenticated:!0,user:{uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL},token:e.accessToken||null}}const s=localStorage.getItem("cybersafe-auth-data");if(s){const e=JSON.parse(s);if(e.user&&e.token)return{isAuthenticated:!0,user:e.user,token:e.token}}const i=sessionStorage.getItem("cybersafe-auth-data");if(i){const e=JSON.parse(i);if(e.user&&e.token)return{isAuthenticated:!0,user:e.user,token:e.token}}const n=localStorage.getItem("cybersafe-react-auth");if(n){const e=JSON.parse(n);if(e.user&&e.token)return{isAuthenticated:!0,user:e.user,token:e.token}}return{isAuthenticated:!1}}catch(s){return console.error("Error getting auth state:",s),{isAuthenticated:!1}}}function o(){const s=c();s.isAuthenticated&&s.user?(window.postMessage({type:"CYBERSAFE_AUTH_SYNC",source:"cybersafe-website",data:{user:s.user,token:s.token,timestamp:Date.now()}},"*"),console.log("Auth state synced with extension:",s.user.email)):(window.postMessage({type:"CYBERSAFE_AUTH_SYNC",source:"cybersafe-website",data:{isAuthenticated:!1,timestamp:Date.now()}},"*"),console.log("User logged out, synced with extension"))}function a(){o(),window.firebase&&window.firebase.auth&&window.firebase.auth().onAuthStateChanged(t=>{console.log("Firebase auth state changed:",t?t.email:"logged out"),o()});const s=localStorage.setItem;localStorage.setItem=function(t,r){s.call(this,t,r),(t.includes("auth")||t.includes("user")||t.includes("firebase"))&&setTimeout(o,100)};const i=localStorage.removeItem;localStorage.removeItem=function(t){i.call(this,t),(t.includes("auth")||t.includes("user")||t.includes("firebase"))&&setTimeout(o,100)};const n=sessionStorage.setItem;sessionStorage.setItem=function(t,r){n.call(this,t,r),(t.includes("auth")||t.includes("user")||t.includes("firebase"))&&setTimeout(o,100)};const e=sessionStorage.removeItem;sessionStorage.removeItem=function(t){e.call(this,t),(t.includes("auth")||t.includes("user")||t.includes("firebase"))&&setTimeout(o,100)};let u=window.location.href;new MutationObserver(()=>{window.location.href!==u&&(u=window.location.href,setTimeout(o,500))}).observe(document.body,{childList:!0,subtree:!0}),setInterval(o,3e4)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a(),setTimeout(a,2e3)})();
