<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CyberSafe India - Extension Authentication</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 40px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      text-align: center;
      max-width: 400px;
      width: 100%;
    }

    .logo {
      width: 64px;
      height: 64px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      font-size: 32px;
    }

    h1 {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 30px;
    }

    .auth-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .auth-button {
      padding: 12px 20px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .auth-button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 12px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .success {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .success-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .error {
      display: none;
      text-align: center;
      padding: 20px;
      color: #ff6b6b;
    }

    .error-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">üõ°Ô∏è</div>
    <h1>CyberSafe India</h1>
    <p class="subtitle">Extension Authentication</p>

    <div id="authButtons" class="auth-buttons">
      <button id="googleSignIn" class="auth-button">
        <span>üîç</span>
        Sign in with Google
      </button>
      <button id="emailSignIn" class="auth-button">
        <span>üìß</span>
        Sign in with Email
      </button>
    </div>

    <div id="loading" class="loading">
      <div class="spinner"></div>
      <div>Signing you in...</div>
    </div>

    <div id="success" class="success">
      <div class="success-icon">‚úÖ</div>
      <div>Successfully signed in!</div>
      <div style="font-size: 12px; opacity: 0.8; margin-top: 8px;">
        You can close this window now.
      </div>
    </div>

    <div id="error" class="error">
      <div class="error-icon">‚ùå</div>
      <div>Authentication failed</div>
      <div style="font-size: 12px; opacity: 0.8; margin-top: 8px;">
        Please try again.
      </div>
    </div>
  </div>

  <script>
    // Get provider from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const provider = urlParams.get('provider') || 'google';

    // Set up authentication based on provider
    if (provider === 'google') {
      document.getElementById('googleSignIn').style.display = 'none';
      document.getElementById('emailSignIn').style.display = 'none';
      showLoading();
      authenticateWithGoogle();
    } else if (provider === 'email') {
      document.getElementById('googleSignIn').style.display = 'none';
      document.getElementById('emailSignIn').style.display = 'none';
      showLoading();
      authenticateWithEmail();
    }

    document.getElementById('googleSignIn').addEventListener('click', () => {
      authenticateWithGoogle();
    });

    document.getElementById('emailSignIn').addEventListener('click', () => {
      authenticateWithEmail();
    });

    function authenticateWithGoogle() {
      showLoading();
      
      // Simulate Google OAuth flow
      setTimeout(() => {
        // In a real implementation, you would:
        // 1. Initialize Firebase Auth
        // 2. Use signInWithPopup() for Google
        // 3. Get the ID token
        // 4. Send it back to the extension
        
        const mockUser = {
          uid: 'google-user-' + Date.now(),
          email: 'user@gmail.com',
          displayName: 'Google User',
          photoURL: 'https://via.placeholder.com/40'
        };
        
        const mockToken = 'google-firebase-id-token-' + Date.now();
        
        sendAuthSuccess(mockUser, mockToken);
      }, 2000);
    }

    function authenticateWithEmail() {
      showLoading();
      
      // Simulate Email/Password authentication
      setTimeout(() => {
        // In a real implementation, you would:
        // 1. Initialize Firebase Auth
        // 2. Use signInWithEmailAndPassword() or createUserWithEmailAndPassword()
        // 3. Get the ID token
        // 4. Send it back to the extension
        
        const mockUser = {
          uid: 'email-user-' + Date.now(),
          email: 'user@example.com',
          displayName: 'Email User',
          photoURL: null
        };
        
        const mockToken = 'email-firebase-id-token-' + Date.now();
        
        sendAuthSuccess(mockUser, mockToken);
      }, 2000);
    }

    function sendAuthSuccess(user, token) {
      // Send authentication data back to extension
      if (window.opener) {
        window.opener.postMessage({
          type: 'AUTH_SUCCESS',
          user: user,
          token: token
        }, '*');
      }
      
      showSuccess();
      
      // Close window after 2 seconds
      setTimeout(() => {
        window.close();
      }, 2000);
    }

    function showLoading() {
      document.getElementById('authButtons').style.display = 'none';
      document.getElementById('loading').style.display = 'block';
      document.getElementById('success').style.display = 'none';
      document.getElementById('error').style.display = 'none';
    }

    function showSuccess() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('success').style.display = 'block';
    }

    function showError() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'block';
    }

    // Handle window close
    window.addEventListener('beforeunload', () => {
      if (window.opener) {
        window.opener.postMessage({
          type: 'AUTH_CANCELLED'
        }, '*');
      }
    });
  </script>
</body>
</html>
